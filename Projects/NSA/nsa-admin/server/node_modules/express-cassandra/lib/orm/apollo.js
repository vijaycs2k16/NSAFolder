'use strict';

var async = require('async');
var util = require('util');
var _ = require('lodash');
var cql = require('dse-driver');

var BaseModel = require('./base_model');
var schemer = require('./apollo_schemer');
var buildError = require('./apollo_error.js');

var DEFAULT_REPLICATION_FACTOR = 1;

var noop = function noop() {};

var Apollo = function f(connection, options) {
  if (!connection) {
    throw buildError('model.validator.invalidconfig', 'Cassandra connection configuration undefined');
  }

  options = options || {};

  if (!options.defaultReplicationStrategy) {
    options.defaultReplicationStrategy = {
      class: 'SimpleStrategy',
      replication_factor: DEFAULT_REPLICATION_FACTOR
    };
  }

  this._options = options;
  this._models = {};
  this._keyspace = connection.keyspace;
  this._connection = connection;
  this._client = null;
};

Apollo.prototype = {
  _generate_model: function _generate_model(properties, callback) {
    var Model = function f() {
      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      BaseModel.apply(this, Array.prototype.slice.call(args));
    };

    util.inherits(Model, BaseModel);

    Object.keys(BaseModel).forEach(function (key) {
      Model[key] = BaseModel[key];
    });

    Model._set_properties(properties);
    Model.syncDefinition(function (err, result) {
      if (typeof callback === 'function') {
        if (err) callback(err);else callback(null, result);
      }
    });

    return Model;
  },
  _get_system_client: function _get_system_client() {
    var connection = _.cloneDeep(this._connection);
    delete connection.keyspace;

    return new cql.Client(connection);
  },
  _generate_replication_text: function _generate_replication_text(replicationOption) {
    if (typeof replicationOption === 'string') {
      return replicationOption;
    }

    var properties = [];
    Object.keys(replicationOption).forEach(function (k) {
      properties.push(util.format("'%s': '%s'", k, replicationOption[k]));
    });

    return util.format('{%s}', properties.join(','));
  },
  _assert_keyspace: function _assert_keyspace(callback) {
    var self = this;
    var client = this._get_system_client();
    var keyspaceName = this._connection.keyspace;
    var replicationText = '';
    var options = this._options;

    var query = util.format("SELECT * FROM system_schema.keyspaces WHERE keyspace_name = '%s';", keyspaceName);
    client.execute(query, function (err, result) {
      if (err) {
        callback(err);
        return;
      }

      var createKeyspace = function createKeyspace() {
        replicationText = self._generate_replication_text(options.defaultReplicationStrategy);

        query = util.format('CREATE KEYSPACE IF NOT EXISTS "%s" WITH REPLICATION = %s;', keyspaceName, replicationText);
        client.execute(query, function (err1, result1) {
          client.shutdown(function () {
            callback(err1, result1);
          });
        });
      };

      var alterKeyspace = function alterKeyspace() {
        replicationText = self._generate_replication_text(options.defaultReplicationStrategy);

        query = util.format('ALTER KEYSPACE "%s" WITH REPLICATION = %s;', keyspaceName, replicationText);
        client.execute(query, function (err1, result1) {
          client.shutdown(function () {
            // eslint-disable-next-line no-console
            console.warn('WARN: KEYSPACE ALTERED! Run the `nodetool repair` command on each affected node.');
            callback(err1, result1);
          });
        });
      };

      if (result.rows && result.rows.length > 0) {
        (function () {
          var dbReplication = result.rows[0].replication;

          Object.keys(dbReplication).forEach(function (key) {
            if (key === 'class') dbReplication[key] = dbReplication[key].replace('org.apache.cassandra.locator.', '');else dbReplication[key] = parseInt(dbReplication[key], 10);
          });

          var ormReplication = options.defaultReplicationStrategy;
          Object.keys(ormReplication).forEach(function (key) {
            if (key === 'class') ormReplication[key] = ormReplication[key].replace('org.apache.cassandra.locator.', '');else ormReplication[key] = parseInt(ormReplication[key], 10);
          });

          if (_.isEqual(dbReplication, ormReplication)) {
            callback();
          } else {
            alterKeyspace();
          }
        })();
      } else {
        createKeyspace();
      }
    });
  },
  _assert_user_defined_types: function _assert_user_defined_types(callback) {
    var client = this._define_connection;
    var options = this._options;
    var keyspace = this._keyspace;

    if (options.udts) {
      async.eachSeries(Object.keys(options.udts), function (udtKey, udtCallback) {
        var query = util.format("SELECT * FROM system_schema.types WHERE keyspace_name = '%s' AND type_name = '%s';", keyspace, udtKey);
        client.execute(query, function (err, result) {
          if (err) {
            udtCallback(err);
            return;
          }

          var createUDT = function createUDT() {
            var udtFields = [];
            Object.keys(options.udts[udtKey]).forEach(function (field) {
              udtFields.push(util.format('"%s" %s', field, options.udts[udtKey][field]));
            });
            query = util.format('CREATE TYPE IF NOT EXISTS "%s" (%s);', udtKey, udtFields.toString());
            client.execute(query, function (err1) {
              udtCallback(err1);
            });
          };

          if (result.rows && result.rows.length > 0) {
            var udtKeys = Object.keys(options.udts[udtKey]);
            var udtValues = _.values(options.udts[udtKey]);
            for (var i = 0; i < udtValues.length; i++) {
              udtValues[i] = udtValues[i].replace(/[\s]/g, '');
              if (udtValues[i].indexOf('<') > -1 && udtValues[i].indexOf('frozen<') !== 0) {
                udtValues[i] = util.format('frozen<%s>', udtValues[i]);
              }
            }

            var fieldNames = result.rows[0].field_names;
            var fieldTypes = result.rows[0].field_types;
            for (var _i = 0; _i < fieldTypes.length; _i++) {
              fieldTypes[_i] = fieldTypes[_i].replace(/[\s]/g, '');
              if (fieldTypes[_i].indexOf('<') > -1 && fieldTypes[_i].indexOf('frozen<') !== 0) {
                fieldTypes[_i] = util.format('frozen<%s>', fieldTypes[_i]);
              }
            }

            if (_.isEqual(udtKeys, fieldNames) && _.isEqual(udtValues, fieldTypes)) {
              udtCallback();
            } else {
              throw new Error(util.format('User defined type "%s" already exists but does not match the udt definition. ' + 'Consider altering or droping the type.', udtKey));
            }
          } else {
            createUDT();
          }
        });
      }, function (err) {
        callback(err);
      });
    } else {
      callback();
    }
  },
  _assert_user_defined_functions: function _assert_user_defined_functions(callback) {
    var client = this._define_connection;
    var options = this._options;
    var keyspace = this._keyspace;

    if (options.udfs) {
      async.eachSeries(Object.keys(options.udfs), function (udfKey, udfCallback) {
        if (!options.udfs[udfKey].returnType) {
          throw new Error(util.format('No returnType defined for user defined function: %s', udfKey));
        }
        if (!options.udfs[udfKey].language) {
          throw new Error(util.format('No language defined for user defined function: %s', udfKey));
        }
        if (!options.udfs[udfKey].code) {
          throw new Error(util.format('No code defined for user defined function: %s', udfKey));
        }
        if (options.udfs[udfKey].inputs && !_.isPlainObject(options.udfs[udfKey].inputs)) {
          throw new Error(util.format('inputs must be an object for user defined function: %s', udfKey));
        }
        if (options.udfs[udfKey].inputs instanceof Array) {
          throw new Error(util.format('inputs must be an object, not an array for user defined function: %s', udfKey));
        }

        var query = util.format("SELECT * FROM system_schema.functions WHERE keyspace_name = '%s' AND function_name = '%s';", keyspace, udfKey.toLowerCase());
        client.execute(query, function (err, result) {
          if (err) {
            udfCallback(err);
            return;
          }

          var createUDF = function createUDF() {
            var udfInputs = [];
            if (options.udfs[udfKey].inputs) {
              Object.keys(options.udfs[udfKey].inputs).forEach(function (input) {
                udfInputs.push(util.format('%s %s', input, options.udfs[udfKey].inputs[input]));
              });
            }
            query = util.format("CREATE OR REPLACE FUNCTION %s (%s) CALLED ON NULL INPUT RETURNS %s LANGUAGE %s AS '%s';", udfKey, udfInputs.toString(), options.udfs[udfKey].returnType, options.udfs[udfKey].language, options.udfs[udfKey].code);
            client.execute(query, function (err1) {
              udfCallback(err1);
            });
          };

          if (result.rows && result.rows.length > 0) {
            var udfLanguage = options.udfs[udfKey].language;
            var resultLanguage = result.rows[0].language;

            var udfCode = options.udfs[udfKey].code;
            var resultCode = result.rows[0].body;

            var udfReturnType = options.udfs[udfKey].returnType;
            udfReturnType = udfReturnType.replace(/[\s]/g, '');
            if (udfReturnType.indexOf('<') > -1 && udfReturnType.indexOf('frozen<') !== 0) {
              udfReturnType = util.format('frozen<%s>', udfReturnType);
            }
            var resultReturnType = result.rows[0].return_type;
            resultReturnType = resultReturnType.replace(/[\s]/g, '');
            if (resultReturnType.indexOf('<') > -1 && resultReturnType.indexOf('frozen<') !== 0) {
              resultReturnType = util.format('frozen<%s>', resultReturnType);
            }

            var udfInputs = options.udfs[udfKey].inputs ? options.udfs[udfKey].inputs : {};
            var udfInputKeys = Object.keys(udfInputs);
            var udfInputValues = _.values(udfInputs);
            for (var i = 0; i < udfInputValues.length; i++) {
              udfInputValues[i] = udfInputValues[i].replace(/[\s]/g, '');
              if (udfInputValues[i].indexOf('<') > -1 && udfInputValues[i].indexOf('frozen<') !== 0) {
                udfInputValues[i] = util.format('frozen<%s>', udfInputValues[i]);
              }
            }
            var resultArgumentNames = result.rows[0].argument_names;
            var resultArgumentTypes = result.rows[0].argument_types;
            for (var _i2 = 0; _i2 < resultArgumentTypes.length; _i2++) {
              resultArgumentTypes[_i2] = resultArgumentTypes[_i2].replace(/[\s]/g, '');
              if (resultArgumentTypes[_i2].indexOf('<') > -1 && resultArgumentTypes[_i2].indexOf('frozen<') !== 0) {
                resultArgumentTypes[_i2] = util.format('frozen<%s>', resultArgumentTypes[_i2]);
              }
            }

            if (udfLanguage === resultLanguage && udfCode === resultCode && udfReturnType === resultReturnType && _.isEqual(udfInputKeys, resultArgumentNames) && _.isEqual(udfInputValues, resultArgumentTypes)) {
              udfCallback();
            } else {
              createUDF();
            }
          } else {
            createUDF();
          }
        });
      }, function (err) {
        callback(err);
      });
    } else {
      callback();
    }
  },
  _assert_user_defined_aggregates: function _assert_user_defined_aggregates(callback) {
    var client = this._define_connection;
    var options = this._options;
    var keyspace = this._keyspace;

    if (options.udas) {
      async.eachSeries(Object.keys(options.udas), function (udaKey, udaCallback) {
        if (!options.udas[udaKey].input_types) {
          throw new Error(util.format('No input_types defined for user defined function: %s', udaKey));
        }
        if (!(options.udas[udaKey].input_types instanceof Array)) {
          throw new Error(util.format('input_types must be an array for user defined function: %s', udaKey));
        }
        if (options.udas[udaKey].input_types.length < 1) {
          throw new Error(util.format('input_types array cannot be blank for user defined function: %s', udaKey));
        }
        if (!options.udas[udaKey].sfunc) {
          throw new Error(util.format('No sfunc defined for user defined aggregate: %s', udaKey));
        }
        if (!options.udas[udaKey].stype) {
          throw new Error(util.format('No stype defined for user defined aggregate: %s', udaKey));
        }
        if (!options.udas[udaKey].initcond) {
          options.udas[udaKey].initcond = null;
        }

        var query = util.format("SELECT * FROM system_schema.aggregates WHERE keyspace_name = '%s' AND aggregate_name = '%s';", keyspace, udaKey.toLowerCase());
        client.execute(query, function (err, result) {
          if (err) {
            udaCallback(err);
            return;
          }

          var createUDA = function createUDA() {
            query = util.format('CREATE OR REPLACE AGGREGATE %s (%s) SFUNC %s STYPE %s', udaKey, options.udas[udaKey].input_types.toString(), options.udas[udaKey].sfunc, options.udas[udaKey].stype);
            if (options.udas[udaKey].finalfunc) query += util.format(' FINALFUNC %s', options.udas[udaKey].finalfunc);
            query += util.format(' INITCOND %s;', options.udas[udaKey].initcond);

            client.execute(query, function (err1) {
              udaCallback(err1);
            });
          };

          if (result.rows && result.rows.length > 0) {
            var inputTypes = options.udas[udaKey].input_types;
            for (var i = 0; i < inputTypes.length; i++) {
              inputTypes[i] = inputTypes[i].replace(/[\s]/g, '');
              if (inputTypes[i].indexOf('<') > -1 && inputTypes[i].indexOf('frozen<') !== 0) {
                inputTypes[i] = util.format('frozen<%s>', inputTypes[i]);
              }
            }
            var sfunc = options.udas[udaKey].sfunc.toLowerCase();
            var stype = options.udas[udaKey].stype;
            stype = stype.replace(/[\s]/g, '');
            if (stype.indexOf('<') > -1 && stype.indexOf('frozen<') !== 0) {
              stype = util.format('frozen<%s>', stype);
            }
            var finalfunc = options.udas[udaKey].finalfunc;
            if (finalfunc) finalfunc = finalfunc.toLowerCase();else finalfunc = null;
            var initcond = options.udas[udaKey].initcond;
            if (initcond) initcond = initcond.replace(/[\s]/g, '');

            for (var _i3 = 0; _i3 < result.rows.length; _i3++) {
              var resultArgumentTypes = result.rows[_i3].argument_types;
              for (var j = 0; j < resultArgumentTypes.length; j++) {
                resultArgumentTypes[j] = resultArgumentTypes[j].replace(/[\s]/g, '');
                if (resultArgumentTypes[j].indexOf('<') > -1 && resultArgumentTypes[j].indexOf('frozen<') !== 0) {
                  resultArgumentTypes[j] = util.format('frozen<%s>', resultArgumentTypes[j]);
                }
              }

              var resultStateFunc = result.rows[_i3].state_func;
              var resultStateType = result.rows[_i3].state_type;
              resultStateType = resultStateType.replace(/[\s]/g, '');
              if (resultStateType.indexOf('<') > -1 && resultStateType.indexOf('frozen<') !== 0) {
                resultStateType = util.format('frozen<%s>', resultStateType);
              }

              var resultFinalFunc = result.rows[_i3].final_func;

              var resultInitcond = result.rows[_i3].initcond;
              if (resultInitcond) resultInitcond = resultInitcond.replace(/[\s]/g, '');

              if (sfunc === resultStateFunc && stype === resultStateType && finalfunc === resultFinalFunc && initcond === resultInitcond && _.isEqual(inputTypes, resultArgumentTypes)) {
                udaCallback();
                return;
              }
            }

            createUDA();
          } else {
            createUDA();
          }
        });
      }, function (err) {
        callback(err);
      });
    } else {
      callback();
    }
  },
  _set_client: function _set_client(client) {
    var _this = this;

    var defineConnectionOptions = _.cloneDeep(this._connection);

    this._client = client;
    this._define_connection = new cql.Client(defineConnectionOptions);

    // Reset connections on all models
    Object.keys(this._models).forEach(function (i) {
      _this._models[i]._properties.cql = _this._client;
      _this._models[i]._properties.define_connection = _this._define_connection;
    });
  },
  connect: function connect(callback) {
    var _this2 = this;

    var onUserDefinedAggregates = function onUserDefinedAggregates(err) {
      if (err) {
        callback(err);
        return;
      }
      callback(err, _this2);
    };

    var onUserDefinedFunctions = function f(err) {
      if (err) {
        callback(err);
        return;
      }
      try {
        this._assert_user_defined_aggregates(onUserDefinedAggregates.bind(this));
      } catch (e) {
        throw buildError('model.validator.invaliduda', e.message);
      }
    };

    var onUserDefinedTypes = function f(err) {
      if (err) {
        callback(err);
        return;
      }
      try {
        this._assert_user_defined_functions(onUserDefinedFunctions.bind(this));
      } catch (e) {
        throw buildError('model.validator.invalidudf', e.message);
      }
    };

    var onKeyspace = function f(err) {
      if (err) {
        callback(err);
        return;
      }
      this._set_client(new cql.Client(this._connection));
      try {
        this._assert_user_defined_types(onUserDefinedTypes.bind(this));
      } catch (e) {
        throw buildError('model.validator.invalidudt', e.message);
      }
    };

    if (this._keyspace && this._options.createKeyspace) {
      this._assert_keyspace(onKeyspace.bind(this));
    } else {
      onKeyspace.call(this);
    }
  },
  add_model: function add_model(modelName, modelSchema, callback) {
    if (!modelName || typeof modelName !== 'string') {
      throw buildError('model.validator.invalidschema', 'Model name must be a valid string');
    }

    try {
      schemer.validate_model_schema(modelSchema);
    } catch (e) {
      throw buildError('model.validator.invalidschema', e.message);
    }

    var baseProperties = {
      name: modelName,
      schema: modelSchema,
      keyspace: this._keyspace,
      define_connection: this._define_connection,
      cql: this._client,
      get_constructor: this.get_model.bind(this, modelName),
      connect: this.connect.bind(this),
      dropTableOnSchemaChange: this._options.dropTableOnSchemaChange,
      migration: this._options.migration,
      disableTTYConfirmation: this._options.disableTTYConfirmation
    };

    return this._models[modelName] = this._generate_model(baseProperties, callback);
  },
  get_model: function get_model(modelName) {
    return this._models[modelName] || null;
  },
  close: function close(callback) {
    var _this3 = this;

    callback = callback || noop;

    if (!this._client) {
      callback();
      return;
    }
    this._client.shutdown(function (err) {
      if (!_this3._define_connection) {
        callback(err);
        return;
      }
      _this3._define_connection.shutdown(function (derr) {
        callback(err || derr);
      });
    });
  }
};

module.exports = Apollo;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcm0vYXBvbGxvLmpzIl0sIm5hbWVzIjpbImFzeW5jIiwicmVxdWlyZSIsInV0aWwiLCJfIiwiY3FsIiwiQmFzZU1vZGVsIiwic2NoZW1lciIsImJ1aWxkRXJyb3IiLCJERUZBVUxUX1JFUExJQ0FUSU9OX0ZBQ1RPUiIsIm5vb3AiLCJBcG9sbG8iLCJmIiwiY29ubmVjdGlvbiIsIm9wdGlvbnMiLCJkZWZhdWx0UmVwbGljYXRpb25TdHJhdGVneSIsImNsYXNzIiwicmVwbGljYXRpb25fZmFjdG9yIiwiX29wdGlvbnMiLCJfbW9kZWxzIiwiX2tleXNwYWNlIiwia2V5c3BhY2UiLCJfY29ubmVjdGlvbiIsIl9jbGllbnQiLCJwcm90b3R5cGUiLCJfZ2VuZXJhdGVfbW9kZWwiLCJwcm9wZXJ0aWVzIiwiY2FsbGJhY2siLCJNb2RlbCIsImFyZ3MiLCJhcHBseSIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwiaW5oZXJpdHMiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsIl9zZXRfcHJvcGVydGllcyIsInN5bmNEZWZpbml0aW9uIiwiZXJyIiwicmVzdWx0IiwiX2dldF9zeXN0ZW1fY2xpZW50IiwiY2xvbmVEZWVwIiwiQ2xpZW50IiwiX2dlbmVyYXRlX3JlcGxpY2F0aW9uX3RleHQiLCJyZXBsaWNhdGlvbk9wdGlvbiIsImsiLCJwdXNoIiwiZm9ybWF0Iiwiam9pbiIsIl9hc3NlcnRfa2V5c3BhY2UiLCJzZWxmIiwiY2xpZW50Iiwia2V5c3BhY2VOYW1lIiwicmVwbGljYXRpb25UZXh0IiwicXVlcnkiLCJleGVjdXRlIiwiY3JlYXRlS2V5c3BhY2UiLCJlcnIxIiwicmVzdWx0MSIsInNodXRkb3duIiwiYWx0ZXJLZXlzcGFjZSIsImNvbnNvbGUiLCJ3YXJuIiwicm93cyIsImxlbmd0aCIsImRiUmVwbGljYXRpb24iLCJyZXBsaWNhdGlvbiIsInJlcGxhY2UiLCJwYXJzZUludCIsIm9ybVJlcGxpY2F0aW9uIiwiaXNFcXVhbCIsIl9hc3NlcnRfdXNlcl9kZWZpbmVkX3R5cGVzIiwiX2RlZmluZV9jb25uZWN0aW9uIiwidWR0cyIsImVhY2hTZXJpZXMiLCJ1ZHRLZXkiLCJ1ZHRDYWxsYmFjayIsImNyZWF0ZVVEVCIsInVkdEZpZWxkcyIsImZpZWxkIiwidG9TdHJpbmciLCJ1ZHRLZXlzIiwidWR0VmFsdWVzIiwidmFsdWVzIiwiaSIsImluZGV4T2YiLCJmaWVsZE5hbWVzIiwiZmllbGRfbmFtZXMiLCJmaWVsZFR5cGVzIiwiZmllbGRfdHlwZXMiLCJFcnJvciIsIl9hc3NlcnRfdXNlcl9kZWZpbmVkX2Z1bmN0aW9ucyIsInVkZnMiLCJ1ZGZLZXkiLCJ1ZGZDYWxsYmFjayIsInJldHVyblR5cGUiLCJsYW5ndWFnZSIsImNvZGUiLCJpbnB1dHMiLCJpc1BsYWluT2JqZWN0IiwidG9Mb3dlckNhc2UiLCJjcmVhdGVVREYiLCJ1ZGZJbnB1dHMiLCJpbnB1dCIsInVkZkxhbmd1YWdlIiwicmVzdWx0TGFuZ3VhZ2UiLCJ1ZGZDb2RlIiwicmVzdWx0Q29kZSIsImJvZHkiLCJ1ZGZSZXR1cm5UeXBlIiwicmVzdWx0UmV0dXJuVHlwZSIsInJldHVybl90eXBlIiwidWRmSW5wdXRLZXlzIiwidWRmSW5wdXRWYWx1ZXMiLCJyZXN1bHRBcmd1bWVudE5hbWVzIiwiYXJndW1lbnRfbmFtZXMiLCJyZXN1bHRBcmd1bWVudFR5cGVzIiwiYXJndW1lbnRfdHlwZXMiLCJfYXNzZXJ0X3VzZXJfZGVmaW5lZF9hZ2dyZWdhdGVzIiwidWRhcyIsInVkYUtleSIsInVkYUNhbGxiYWNrIiwiaW5wdXRfdHlwZXMiLCJzZnVuYyIsInN0eXBlIiwiaW5pdGNvbmQiLCJjcmVhdGVVREEiLCJmaW5hbGZ1bmMiLCJpbnB1dFR5cGVzIiwiaiIsInJlc3VsdFN0YXRlRnVuYyIsInN0YXRlX2Z1bmMiLCJyZXN1bHRTdGF0ZVR5cGUiLCJzdGF0ZV90eXBlIiwicmVzdWx0RmluYWxGdW5jIiwiZmluYWxfZnVuYyIsInJlc3VsdEluaXRjb25kIiwiX3NldF9jbGllbnQiLCJkZWZpbmVDb25uZWN0aW9uT3B0aW9ucyIsIl9wcm9wZXJ0aWVzIiwiZGVmaW5lX2Nvbm5lY3Rpb24iLCJjb25uZWN0Iiwib25Vc2VyRGVmaW5lZEFnZ3JlZ2F0ZXMiLCJvblVzZXJEZWZpbmVkRnVuY3Rpb25zIiwiYmluZCIsImUiLCJtZXNzYWdlIiwib25Vc2VyRGVmaW5lZFR5cGVzIiwib25LZXlzcGFjZSIsImFkZF9tb2RlbCIsIm1vZGVsTmFtZSIsIm1vZGVsU2NoZW1hIiwidmFsaWRhdGVfbW9kZWxfc2NoZW1hIiwiYmFzZVByb3BlcnRpZXMiLCJuYW1lIiwic2NoZW1hIiwiZ2V0X2NvbnN0cnVjdG9yIiwiZ2V0X21vZGVsIiwiZHJvcFRhYmxlT25TY2hlbWFDaGFuZ2UiLCJtaWdyYXRpb24iLCJkaXNhYmxlVFRZQ29uZmlybWF0aW9uIiwiY2xvc2UiLCJkZXJyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxRQUFRQyxRQUFRLE9BQVIsQ0FBZDtBQUNBLElBQU1DLE9BQU9ELFFBQVEsTUFBUixDQUFiO0FBQ0EsSUFBTUUsSUFBSUYsUUFBUSxRQUFSLENBQVY7QUFDQSxJQUFNRyxNQUFNSCxRQUFRLFlBQVIsQ0FBWjs7QUFFQSxJQUFNSSxZQUFZSixRQUFRLGNBQVIsQ0FBbEI7QUFDQSxJQUFNSyxVQUFVTCxRQUFRLGtCQUFSLENBQWhCO0FBQ0EsSUFBTU0sYUFBYU4sUUFBUSxtQkFBUixDQUFuQjs7QUFFQSxJQUFNTyw2QkFBNkIsQ0FBbkM7O0FBRUEsSUFBTUMsT0FBTyxTQUFQQSxJQUFPLEdBQU0sQ0FBRSxDQUFyQjs7QUFFQSxJQUFNQyxTQUFTLFNBQVNDLENBQVQsQ0FBV0MsVUFBWCxFQUF1QkMsT0FBdkIsRUFBZ0M7QUFDN0MsTUFBSSxDQUFDRCxVQUFMLEVBQWlCO0FBQ2YsVUFBT0wsV0FBVywrQkFBWCxFQUE0Qyw4Q0FBNUMsQ0FBUDtBQUNEOztBQUVETSxZQUFVQSxXQUFXLEVBQXJCOztBQUVBLE1BQUksQ0FBQ0EsUUFBUUMsMEJBQWIsRUFBeUM7QUFD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Iiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYXN5bmMgPSByZXF1aXJlKCdhc3luYycpO1xuY29uc3QgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcbmNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbmNvbnN0IGNxbCA9IHJlcXVpcmUoJ2RzZS1kcml2ZXInKTtcblxuY29uc3QgQmFzZU1vZGVsID0gcmVxdWlyZSgnLi9iYXNlX21vZGVsJyk7XG5jb25zdCBzY2hlbWVyID0gcmVxdWlyZSgnLi9hcG9sbG9fc2NoZW1lcicpO1xuY29uc3QgYnVpbGRFcnJvciA9IHJlcXVpcmUoJy4vYXBvbGxvX2Vycm9yLmpzJyk7XG5cbmNvbnN0IERFRkFVTFRfUkVQTElDQVRJT05fRkFDVE9SID0gMTtcblxuY29uc3Qgbm9vcCA9ICgpID0+IHt9O1xuXG5jb25zdCBBcG9sbG8gPSBmdW5jdGlvbiBmKGNvbm5lY3Rpb24sIG9wdGlvbnMpIHtcbiAgaWYgKCFjb25uZWN0aW9uKSB7XG4gICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnZhbGlkYXRvci5pbnZhbGlkY29uZmlnJywgJ0Nhc3NhbmRyYSBjb25uZWN0aW9uIGNvbmZpZ3VyYXRpb24gdW5kZWZpbmVkJykpO1xuICB9XG5cbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgaWYgKCFvcHRpb25zLmRlZmF1bHRSZXBsaWNhdGlvblN0cmF0ZWd5KSB7XG4gICAgb3B0aW9ucy5kZWZhdWx0UmVwbGljYXRpb25TdHJhdGVneSA9IHtcbiAgICAgIGNsYXNzOiAnU2ltcGxlU3RyYXRlZ3knLFxuICAgICAgcmVwbGljYXRpb25fZmFjdG9yOiBERUZBVUxUX1JFUExJQ0FUSU9OX0ZBQ1RPUixcbiAgICB9O1xuICB9XG5cbiAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XG4gIHRoaXMuX21vZGVscyA9IHt9O1xuICB0aGlzLl9rZXlzcGFjZSA9IGNvbm5lY3Rpb24ua2V5c3BhY2U7XG4gIHRoaXMuX2Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICB0aGlzLl9jbGllbnQgPSBudWxsO1xufTtcblxuQXBvbGxvLnByb3RvdHlwZSA9IHtcblxuICBfZ2VuZXJhdGVfbW9kZWwocHJvcGVydGllcywgY2FsbGJhY2spIHtcbiAgICBjb25zdCBNb2RlbCA9IGZ1bmN0aW9uIGYoLi4uYXJncykge1xuICAgICAgQmFzZU1vZGVsLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3MpKTtcbiAgICB9O1xuXG4gICAgdXRpbC5pbmhlcml0cyhNb2RlbCwgQmFzZU1vZGVsKTtcblxuICAgIE9iamVjdC5rZXlzKEJhc2VNb2RlbCkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBNb2RlbFtrZXldID0gQmFzZU1vZGVsW2tleV07XG4gICAgfSk7XG5cbiAgICBNb2RlbC5fc2V0X3Byb3BlcnRpZXMocHJvcGVydGllcyk7XG4gICAgTW9kZWwuc3luY0RlZmluaXRpb24oKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGlmIChlcnIpIGNhbGxiYWNrKGVycik7XG4gICAgICAgIGVsc2UgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBNb2RlbDtcbiAgfSxcblxuICBfZ2V0X3N5c3RlbV9jbGllbnQoKSB7XG4gICAgY29uc3QgY29ubmVjdGlvbiA9IF8uY2xvbmVEZWVwKHRoaXMuX2Nvbm5lY3Rpb24pO1xuICAgIGRlbGV0ZSBjb25uZWN0aW9uLmtleXNwYWNlO1xuXG4gICAgcmV0dXJuIG5ldyBjcWwuQ2xpZW50KGNvbm5lY3Rpb24pO1xuICB9LFxuXG4gIF9nZW5lcmF0ZV9yZXBsaWNhdGlvbl90ZXh0KHJlcGxpY2F0aW9uT3B0aW9uKSB7XG4gICAgaWYgKHR5cGVvZiByZXBsaWNhdGlvbk9wdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiByZXBsaWNhdGlvbk9wdGlvbjtcbiAgICB9XG5cbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gW107XG4gICAgT2JqZWN0LmtleXMocmVwbGljYXRpb25PcHRpb24pLmZvckVhY2goKGspID0+IHtcbiAgICAgIHByb3BlcnRpZXMucHVzaCh1dGlsLmZvcm1hdChcIiclcyc6ICclcydcIiwgaywgcmVwbGljYXRpb25PcHRpb25ba10pKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB1dGlsLmZvcm1hdCgneyVzfScsIHByb3BlcnRpZXMuam9pbignLCcpKTtcbiAgfSxcblxuICBfYXNzZXJ0X2tleXNwYWNlKGNhbGxiYWNrKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5fZ2V0X3N5c3RlbV9jbGllbnQoKTtcbiAgICBjb25zdCBrZXlzcGFjZU5hbWUgPSB0aGlzLl9jb25uZWN0aW9uLmtleXNwYWNlO1xuICAgIGxldCByZXBsaWNhdGlvblRleHQgPSAnJztcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5fb3B0aW9ucztcblxuICAgIGxldCBxdWVyeSA9IHV0aWwuZm9ybWF0KFxuICAgICAgXCJTRUxFQ1QgKiBGUk9NIHN5c3RlbV9zY2hlbWEua2V5c3BhY2VzIFdIRVJFIGtleXNwYWNlX25hbWUgPSAnJXMnO1wiLFxuICAgICAga2V5c3BhY2VOYW1lLFxuICAgICk7XG4gICAgY2xpZW50LmV4ZWN1dGUocXVlcnksIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNyZWF0ZUtleXNwYWNlID0gKCkgPT4ge1xuICAgICAgICByZXBsaWNhdGlvblRleHQgPSBzZWxmLl9nZW5lcmF0ZV9yZXBsaWNhdGlvbl90ZXh0KG9wdGlvbnMuZGVmYXVsdFJlcGxpY2F0aW9uU3RyYXRlZ3kpO1xuXG4gICAgICAgIHF1ZXJ5ID0gdXRpbC5mb3JtYXQoXG4gICAgICAgICAgJ0NSRUFURSBLRVlTUEFDRSBJRiBOT1QgRVhJU1RTIFwiJXNcIiBXSVRIIFJFUExJQ0FUSU9OID0gJXM7JyxcbiAgICAgICAgICBrZXlzcGFjZU5hbWUsXG4gICAgICAgICAgcmVwbGljYXRpb25UZXh0LFxuICAgICAgICApO1xuICAgICAgICBjbGllbnQuZXhlY3V0ZShxdWVyeSwgKGVycjEsIHJlc3VsdDEpID0+IHtcbiAgICAgICAgICBjbGllbnQuc2h1dGRvd24oKCkgPT4ge1xuICAgICAgICAgICAgY2FsbGJhY2soZXJyMSwgcmVzdWx0MSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgYWx0ZXJLZXlzcGFjZSA9ICgpID0+IHtcbiAgICAgICAgcmVwbGljYXRpb25UZXh0ID0gc2VsZi5fZ2VuZXJhdGVfcmVwbGljYXRpb25fdGV4dChvcHRpb25zLmRlZmF1bHRSZXBsaWNhdGlvblN0cmF0ZWd5KTtcblxuICAgICAgICBxdWVyeSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAgICdBTFRFUiBLRVlTUEFDRSBcIiVzXCIgV0lUSCBSRVBMSUNBVElPTiA9ICVzOycsXG4gICAgICAgICAga2V5c3BhY2VOYW1lLFxuICAgICAgICAgIHJlcGxpY2F0aW9uVGV4dCxcbiAgICAgICAgKTtcbiAgICAgICAgY2xpZW50LmV4ZWN1dGUocXVlcnksIChlcnIxLCByZXN1bHQxKSA9PiB7XG4gICAgICAgICAgY2xpZW50LnNodXRkb3duKCgpID0+IHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1dBUk46IEtFWVNQQUNFIEFMVEVSRUQhIFJ1biB0aGUgYG5vZGV0b29sIHJlcGFpcmAgY29tbWFuZCBvbiBlYWNoIGFmZmVjdGVkIG5vZGUuJyk7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIxLCByZXN1bHQxKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBpZiAocmVzdWx0LnJvd3MgJiYgcmVzdWx0LnJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBkYlJlcGxpY2F0aW9uID0gcmVzdWx0LnJvd3NbMF0ucmVwbGljYXRpb247XG5cbiAgICAgICAgT2JqZWN0LmtleXMoZGJSZXBsaWNhdGlvbikuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgaWYgKGtleSA9PT0gJ2NsYXNzJykgZGJSZXBsaWNhdGlvbltrZXldID0gZGJSZXBsaWNhdGlvbltrZXldLnJlcGxhY2UoJ29yZy5hcGFjaGUuY2Fzc2FuZHJhLmxvY2F0b3IuJywgJycpO1xuICAgICAgICAgIGVsc2UgZGJSZXBsaWNhdGlvbltrZXldID0gcGFyc2VJbnQoZGJSZXBsaWNhdGlvbltrZXldLCAxMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IG9ybVJlcGxpY2F0aW9uID0gb3B0aW9ucy5kZWZhdWx0UmVwbGljYXRpb25TdHJhdGVneTtcbiAgICAgICAgT2JqZWN0LmtleXMob3JtUmVwbGljYXRpb24pLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgIGlmIChrZXkgPT09ICdjbGFzcycpIG9ybVJlcGxpY2F0aW9uW2tleV0gPSBvcm1SZXBsaWNhdGlvbltrZXldLnJlcGxhY2UoJ29yZy5hcGFjaGUuY2Fzc2FuZHJhLmxvY2F0b3IuJywgJycpO1xuICAgICAgICAgIGVsc2Ugb3JtUmVwbGljYXRpb25ba2V5XSA9IHBhcnNlSW50KG9ybVJlcGxpY2F0aW9uW2tleV0sIDEwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKF8uaXNFcXVhbChkYlJlcGxpY2F0aW9uLCBvcm1SZXBsaWNhdGlvbikpIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFsdGVyS2V5c3BhY2UoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3JlYXRlS2V5c3BhY2UoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBfYXNzZXJ0X3VzZXJfZGVmaW5lZF90eXBlcyhjYWxsYmFjaykge1xuICAgIGNvbnN0IGNsaWVudCA9IHRoaXMuX2RlZmluZV9jb25uZWN0aW9uO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLl9vcHRpb25zO1xuICAgIGNvbnN0IGtleXNwYWNlID0gdGhpcy5fa2V5c3BhY2U7XG5cbiAgICBpZiAob3B0aW9ucy51ZHRzKSB7XG4gICAgICBhc3luYy5lYWNoU2VyaWVzKE9iamVjdC5rZXlzKG9wdGlvbnMudWR0cyksICh1ZHRLZXksIHVkdENhbGxiYWNrKSA9PiB7XG4gICAgICAgIGxldCBxdWVyeSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAgIFwiU0VMRUNUICogRlJPTSBzeXN0ZW1fc2NoZW1hLnR5cGVzIFdIRVJFIGtleXNwYWNlX25hbWUgPSAnJXMnIEFORCB0eXBlX25hbWUgPSAnJXMnO1wiLFxuICAgICAgICAgIGtleXNwYWNlLFxuICAgICAgICAgIHVkdEtleSxcbiAgICAgICAgKTtcbiAgICAgICAgY2xpZW50LmV4ZWN1dGUocXVlcnksIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHVkdENhbGxiYWNrKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgY3JlYXRlVURUID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdWR0RmllbGRzID0gW107XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvcHRpb25zLnVkdHNbdWR0S2V5XSkuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgICAgdWR0RmllbGRzLnB1c2godXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAgICAgJ1wiJXNcIiAlcycsXG4gICAgICAgICAgICAgICAgZmllbGQsXG4gICAgICAgICAgICAgICAgb3B0aW9ucy51ZHRzW3VkdEtleV1bZmllbGRdLFxuICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcXVlcnkgPSB1dGlsLmZvcm1hdChcbiAgICAgICAgICAgICAgJ0NSRUFURSBUWVBFIElGIE5PVCBFWElTVFMgXCIlc1wiICglcyk7JyxcbiAgICAgICAgICAgICAgdWR0S2V5LFxuICAgICAgICAgICAgICB1ZHRGaWVsZHMudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjbGllbnQuZXhlY3V0ZShxdWVyeSwgKGVycjEpID0+IHtcbiAgICAgICAgICAgICAgdWR0Q2FsbGJhY2soZXJyMSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgaWYgKHJlc3VsdC5yb3dzICYmIHJlc3VsdC5yb3dzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHVkdEtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zLnVkdHNbdWR0S2V5XSk7XG4gICAgICAgICAgICBjb25zdCB1ZHRWYWx1ZXMgPSBfLnZhbHVlcyhvcHRpb25zLnVkdHNbdWR0S2V5XSk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVkdFZhbHVlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICB1ZHRWYWx1ZXNbaV0gPSB1ZHRWYWx1ZXNbaV0ucmVwbGFjZSgvW1xcc10vZywgJycpO1xuICAgICAgICAgICAgICBpZiAodWR0VmFsdWVzW2ldLmluZGV4T2YoJzwnKSA+IC0xICYmIHVkdFZhbHVlc1tpXS5pbmRleE9mKCdmcm96ZW48JykgIT09IDApIHtcbiAgICAgICAgICAgICAgICB1ZHRWYWx1ZXNbaV0gPSB1dGlsLmZvcm1hdCgnZnJvemVuPCVzPicsIHVkdFZhbHVlc1tpXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZmllbGROYW1lcyA9IHJlc3VsdC5yb3dzWzBdLmZpZWxkX25hbWVzO1xuICAgICAgICAgICAgY29uc3QgZmllbGRUeXBlcyA9IHJlc3VsdC5yb3dzWzBdLmZpZWxkX3R5cGVzO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWVsZFR5cGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIGZpZWxkVHlwZXNbaV0gPSBmaWVsZFR5cGVzW2ldLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgICAgaWYgKGZpZWxkVHlwZXNbaV0uaW5kZXhPZignPCcpID4gLTEgJiYgZmllbGRUeXBlc1tpXS5pbmRleE9mKCdmcm96ZW48JykgIT09IDApIHtcbiAgICAgICAgICAgICAgICBmaWVsZFR5cGVzW2ldID0gdXRpbC5mb3JtYXQoJ2Zyb3plbjwlcz4nLCBmaWVsZFR5cGVzW2ldKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoXy5pc0VxdWFsKHVkdEtleXMsIGZpZWxkTmFtZXMpICYmIF8uaXNFcXVhbCh1ZHRWYWx1ZXMsIGZpZWxkVHlwZXMpKSB7XG4gICAgICAgICAgICAgIHVkdENhbGxiYWNrKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgICAgIHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgICAgICAgJ1VzZXIgZGVmaW5lZCB0eXBlIFwiJXNcIiBhbHJlYWR5IGV4aXN0cyBidXQgZG9lcyBub3QgbWF0Y2ggdGhlIHVkdCBkZWZpbml0aW9uLiAnICtcbiAgICAgICAgICAgICAgICAgICdDb25zaWRlciBhbHRlcmluZyBvciBkcm9waW5nIHRoZSB0eXBlLicsXG4gICAgICAgICAgICAgICAgICB1ZHRLZXksXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNyZWF0ZVVEVCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9LCAoZXJyKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH0sXG5cbiAgX2Fzc2VydF91c2VyX2RlZmluZWRfZnVuY3Rpb25zKGNhbGxiYWNrKSB7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5fZGVmaW5lX2Nvbm5lY3Rpb247XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuX29wdGlvbnM7XG4gICAgY29uc3Qga2V5c3BhY2UgPSB0aGlzLl9rZXlzcGFjZTtcblxuICAgIGlmIChvcHRpb25zLnVkZnMpIHtcbiAgICAgIGFzeW5jLmVhY2hTZXJpZXMoT2JqZWN0LmtleXMob3B0aW9ucy51ZGZzKSwgKHVkZktleSwgdWRmQ2FsbGJhY2spID0+IHtcbiAgICAgICAgaWYgKCFvcHRpb25zLnVkZnNbdWRmS2V5XS5yZXR1cm5UeXBlKSB7XG4gICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdObyByZXR1cm5UeXBlIGRlZmluZWQgZm9yIHVzZXIgZGVmaW5lZCBmdW5jdGlvbjogJXMnLCB1ZGZLZXkpLFxuICAgICAgICAgICkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb3B0aW9ucy51ZGZzW3VkZktleV0ubGFuZ3VhZ2UpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgdXRpbC5mb3JtYXQoJ05vIGxhbmd1YWdlIGRlZmluZWQgZm9yIHVzZXIgZGVmaW5lZCBmdW5jdGlvbjogJXMnLCB1ZGZLZXkpLFxuICAgICAgICAgICkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb3B0aW9ucy51ZGZzW3VkZktleV0uY29kZSkge1xuICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICB1dGlsLmZvcm1hdCgnTm8gY29kZSBkZWZpbmVkIGZvciB1c2VyIGRlZmluZWQgZnVuY3Rpb246ICVzJywgdWRmS2V5KSxcbiAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy51ZGZzW3VkZktleV0uaW5wdXRzICYmICFfLmlzUGxhaW5PYmplY3Qob3B0aW9ucy51ZGZzW3VkZktleV0uaW5wdXRzKSkge1xuICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICB1dGlsLmZvcm1hdCgnaW5wdXRzIG11c3QgYmUgYW4gb2JqZWN0IGZvciB1c2VyIGRlZmluZWQgZnVuY3Rpb246ICVzJywgdWRmS2V5KSxcbiAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy51ZGZzW3VkZktleV0uaW5wdXRzIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgdXRpbC5mb3JtYXQoJ2lucHV0cyBtdXN0IGJlIGFuIG9iamVjdCwgbm90IGFuIGFycmF5IGZvciB1c2VyIGRlZmluZWQgZnVuY3Rpb246ICVzJywgdWRmS2V5KSxcbiAgICAgICAgICApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBxdWVyeSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAgIFwiU0VMRUNUICogRlJPTSBzeXN0ZW1fc2NoZW1hLmZ1bmN0aW9ucyBXSEVSRSBrZXlzcGFjZV9uYW1lID0gJyVzJyBBTkQgZnVuY3Rpb25fbmFtZSA9ICclcyc7XCIsXG4gICAgICAgICAga2V5c3BhY2UsXG4gICAgICAgICAgdWRmS2V5LnRvTG93ZXJDYXNlKCksXG4gICAgICAgICk7XG4gICAgICAgIGNsaWVudC5leGVjdXRlKHF1ZXJ5LCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICB1ZGZDYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGNyZWF0ZVVERiA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVkZklucHV0cyA9IFtdO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMudWRmc1t1ZGZLZXldLmlucHV0cykge1xuICAgICAgICAgICAgICBPYmplY3Qua2V5cyhvcHRpb25zLnVkZnNbdWRmS2V5XS5pbnB1dHMpLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgdWRmSW5wdXRzLnB1c2godXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAgICAgICAnJXMgJXMnLFxuICAgICAgICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgICAgICAgICAgICBvcHRpb25zLnVkZnNbdWRmS2V5XS5pbnB1dHNbaW5wdXRdLFxuICAgICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHF1ZXJ5ID0gdXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAgIFwiQ1JFQVRFIE9SIFJFUExBQ0UgRlVOQ1RJT04gJXMgKCVzKSBDQUxMRUQgT04gTlVMTCBJTlBVVCBSRVRVUk5TICVzIExBTkdVQUdFICVzIEFTICclcyc7XCIsXG4gICAgICAgICAgICAgIHVkZktleSxcbiAgICAgICAgICAgICAgdWRmSW5wdXRzLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgIG9wdGlvbnMudWRmc1t1ZGZLZXldLnJldHVyblR5cGUsXG4gICAgICAgICAgICAgIG9wdGlvbnMudWRmc1t1ZGZLZXldLmxhbmd1YWdlLFxuICAgICAgICAgICAgICBvcHRpb25zLnVkZnNbdWRmS2V5XS5jb2RlLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNsaWVudC5leGVjdXRlKHF1ZXJ5LCAoZXJyMSkgPT4ge1xuICAgICAgICAgICAgICB1ZGZDYWxsYmFjayhlcnIxKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBpZiAocmVzdWx0LnJvd3MgJiYgcmVzdWx0LnJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgdWRmTGFuZ3VhZ2UgPSBvcHRpb25zLnVkZnNbdWRmS2V5XS5sYW5ndWFnZTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdExhbmd1YWdlID0gcmVzdWx0LnJvd3NbMF0ubGFuZ3VhZ2U7XG5cbiAgICAgICAgICAgIGNvbnN0IHVkZkNvZGUgPSBvcHRpb25zLnVkZnNbdWRmS2V5XS5jb2RlO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0Q29kZSA9IHJlc3VsdC5yb3dzWzBdLmJvZHk7XG5cbiAgICAgICAgICAgIGxldCB1ZGZSZXR1cm5UeXBlID0gb3B0aW9ucy51ZGZzW3VkZktleV0ucmV0dXJuVHlwZTtcbiAgICAgICAgICAgIHVkZlJldHVyblR5cGUgPSB1ZGZSZXR1cm5UeXBlLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgIGlmICh1ZGZSZXR1cm5UeXBlLmluZGV4T2YoJzwnKSA+IC0xICYmIHVkZlJldHVyblR5cGUuaW5kZXhPZignZnJvemVuPCcpICE9PSAwKSB7XG4gICAgICAgICAgICAgIHVkZlJldHVyblR5cGUgPSB1dGlsLmZvcm1hdCgnZnJvemVuPCVzPicsIHVkZlJldHVyblR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHJlc3VsdFJldHVyblR5cGUgPSByZXN1bHQucm93c1swXS5yZXR1cm5fdHlwZTtcbiAgICAgICAgICAgIHJlc3VsdFJldHVyblR5cGUgPSByZXN1bHRSZXR1cm5UeXBlLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHRSZXR1cm5UeXBlLmluZGV4T2YoJzwnKSA+IC0xICYmIHJlc3VsdFJldHVyblR5cGUuaW5kZXhPZignZnJvemVuPCcpICE9PSAwKSB7XG4gICAgICAgICAgICAgIHJlc3VsdFJldHVyblR5cGUgPSB1dGlsLmZvcm1hdCgnZnJvemVuPCVzPicsIHJlc3VsdFJldHVyblR5cGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCB1ZGZJbnB1dHMgPSBvcHRpb25zLnVkZnNbdWRmS2V5XS5pbnB1dHMgPyBvcHRpb25zLnVkZnNbdWRmS2V5XS5pbnB1dHMgOiB7fTtcbiAgICAgICAgICAgIGNvbnN0IHVkZklucHV0S2V5cyA9IE9iamVjdC5rZXlzKHVkZklucHV0cyk7XG4gICAgICAgICAgICBjb25zdCB1ZGZJbnB1dFZhbHVlcyA9IF8udmFsdWVzKHVkZklucHV0cyk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVkZklucHV0VmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIHVkZklucHV0VmFsdWVzW2ldID0gdWRmSW5wdXRWYWx1ZXNbaV0ucmVwbGFjZSgvW1xcc10vZywgJycpO1xuICAgICAgICAgICAgICBpZiAodWRmSW5wdXRWYWx1ZXNbaV0uaW5kZXhPZignPCcpID4gLTEgJiYgdWRmSW5wdXRWYWx1ZXNbaV0uaW5kZXhPZignZnJvemVuPCcpICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgdWRmSW5wdXRWYWx1ZXNbaV0gPSB1dGlsLmZvcm1hdCgnZnJvemVuPCVzPicsIHVkZklucHV0VmFsdWVzW2ldKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0QXJndW1lbnROYW1lcyA9IHJlc3VsdC5yb3dzWzBdLmFyZ3VtZW50X25hbWVzO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0QXJndW1lbnRUeXBlcyA9IHJlc3VsdC5yb3dzWzBdLmFyZ3VtZW50X3R5cGVzO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHRBcmd1bWVudFR5cGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIHJlc3VsdEFyZ3VtZW50VHlwZXNbaV0gPSByZXN1bHRBcmd1bWVudFR5cGVzW2ldLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdEFyZ3VtZW50VHlwZXNbaV0uaW5kZXhPZignPCcpID4gLTEgJiYgcmVzdWx0QXJndW1lbnRUeXBlc1tpXS5pbmRleE9mKCdmcm96ZW48JykgIT09IDApIHtcbiAgICAgICAgICAgICAgICByZXN1bHRBcmd1bWVudFR5cGVzW2ldID0gdXRpbC5mb3JtYXQoJ2Zyb3plbjwlcz4nLCByZXN1bHRBcmd1bWVudFR5cGVzW2ldKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodWRmTGFuZ3VhZ2UgPT09IHJlc3VsdExhbmd1YWdlICYmXG4gICAgICAgICAgICAgIHVkZkNvZGUgPT09IHJlc3VsdENvZGUgJiZcbiAgICAgICAgICAgICAgdWRmUmV0dXJuVHlwZSA9PT0gcmVzdWx0UmV0dXJuVHlwZSAmJlxuICAgICAgICAgICAgICBfLmlzRXF1YWwodWRmSW5wdXRLZXlzLCByZXN1bHRBcmd1bWVudE5hbWVzKSAmJlxuICAgICAgICAgICAgICBfLmlzRXF1YWwodWRmSW5wdXRWYWx1ZXMsIHJlc3VsdEFyZ3VtZW50VHlwZXMpKSB7XG4gICAgICAgICAgICAgIHVkZkNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjcmVhdGVVREYoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3JlYXRlVURGKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sIChlcnIpID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgfSxcblxuICBfYXNzZXJ0X3VzZXJfZGVmaW5lZF9hZ2dyZWdhdGVzKGNhbGxiYWNrKSB7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5fZGVmaW5lX2Nvbm5lY3Rpb247XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuX29wdGlvbnM7XG4gICAgY29uc3Qga2V5c3BhY2UgPSB0aGlzLl9rZXlzcGFjZTtcblxuICAgIGlmIChvcHRpb25zLnVkYXMpIHtcbiAgICAgIGFzeW5jLmVhY2hTZXJpZXMoT2JqZWN0LmtleXMob3B0aW9ucy51ZGFzKSwgKHVkYUtleSwgdWRhQ2FsbGJhY2spID0+IHtcbiAgICAgICAgaWYgKCFvcHRpb25zLnVkYXNbdWRhS2V5XS5pbnB1dF90eXBlcykge1xuICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICB1dGlsLmZvcm1hdCgnTm8gaW5wdXRfdHlwZXMgZGVmaW5lZCBmb3IgdXNlciBkZWZpbmVkIGZ1bmN0aW9uOiAlcycsIHVkYUtleSksXG4gICAgICAgICAgKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEob3B0aW9ucy51ZGFzW3VkYUtleV0uaW5wdXRfdHlwZXMgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgdXRpbC5mb3JtYXQoJ2lucHV0X3R5cGVzIG11c3QgYmUgYW4gYXJyYXkgZm9yIHVzZXIgZGVmaW5lZCBmdW5jdGlvbjogJXMnLCB1ZGFLZXkpLFxuICAgICAgICAgICkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnVkYXNbdWRhS2V5XS5pbnB1dF90eXBlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdpbnB1dF90eXBlcyBhcnJheSBjYW5ub3QgYmUgYmxhbmsgZm9yIHVzZXIgZGVmaW5lZCBmdW5jdGlvbjogJXMnLCB1ZGFLZXkpLFxuICAgICAgICAgICkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb3B0aW9ucy51ZGFzW3VkYUtleV0uc2Z1bmMpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgdXRpbC5mb3JtYXQoJ05vIHNmdW5jIGRlZmluZWQgZm9yIHVzZXIgZGVmaW5lZCBhZ2dyZWdhdGU6ICVzJywgdWRhS2V5KSxcbiAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9wdGlvbnMudWRhc1t1ZGFLZXldLnN0eXBlKSB7XG4gICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdObyBzdHlwZSBkZWZpbmVkIGZvciB1c2VyIGRlZmluZWQgYWdncmVnYXRlOiAlcycsIHVkYUtleSksXG4gICAgICAgICAgKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvcHRpb25zLnVkYXNbdWRhS2V5XS5pbml0Y29uZCkge1xuICAgICAgICAgIG9wdGlvbnMudWRhc1t1ZGFLZXldLmluaXRjb25kID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBxdWVyeSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAgIFwiU0VMRUNUICogRlJPTSBzeXN0ZW1fc2NoZW1hLmFnZ3JlZ2F0ZXMgV0hFUkUga2V5c3BhY2VfbmFtZSA9ICclcycgQU5EIGFnZ3JlZ2F0ZV9uYW1lID0gJyVzJztcIixcbiAgICAgICAgICBrZXlzcGFjZSxcbiAgICAgICAgICB1ZGFLZXkudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgKTtcbiAgICAgICAgY2xpZW50LmV4ZWN1dGUocXVlcnksIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHVkYUNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgY3JlYXRlVURBID0gKCkgPT4ge1xuICAgICAgICAgICAgcXVlcnkgPSB1dGlsLmZvcm1hdChcbiAgICAgICAgICAgICAgJ0NSRUFURSBPUiBSRVBMQUNFIEFHR1JFR0FURSAlcyAoJXMpIFNGVU5DICVzIFNUWVBFICVzJyxcbiAgICAgICAgICAgICAgdWRhS2V5LFxuICAgICAgICAgICAgICBvcHRpb25zLnVkYXNbdWRhS2V5XS5pbnB1dF90eXBlcy50b1N0cmluZygpLFxuICAgICAgICAgICAgICBvcHRpb25zLnVkYXNbdWRhS2V5XS5zZnVuYyxcbiAgICAgICAgICAgICAgb3B0aW9ucy51ZGFzW3VkYUtleV0uc3R5cGUsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMudWRhc1t1ZGFLZXldLmZpbmFsZnVuYykgcXVlcnkgKz0gdXRpbC5mb3JtYXQoJyBGSU5BTEZVTkMgJXMnLCBvcHRpb25zLnVkYXNbdWRhS2V5XS5maW5hbGZ1bmMpO1xuICAgICAgICAgICAgcXVlcnkgKz0gdXRpbC5mb3JtYXQoJyBJTklUQ09ORCAlczsnLCBvcHRpb25zLnVkYXNbdWRhS2V5XS5pbml0Y29uZCk7XG5cbiAgICAgICAgICAgIGNsaWVudC5leGVjdXRlKHF1ZXJ5LCAoZXJyMSkgPT4ge1xuICAgICAgICAgICAgICB1ZGFDYWxsYmFjayhlcnIxKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBpZiAocmVzdWx0LnJvd3MgJiYgcmVzdWx0LnJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgaW5wdXRUeXBlcyA9IG9wdGlvbnMudWRhc1t1ZGFLZXldLmlucHV0X3R5cGVzO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dFR5cGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIGlucHV0VHlwZXNbaV0gPSBpbnB1dFR5cGVzW2ldLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgICAgaWYgKGlucHV0VHlwZXNbaV0uaW5kZXhPZignPCcpID4gLTEgJiYgaW5wdXRUeXBlc1tpXS5pbmRleE9mKCdmcm96ZW48JykgIT09IDApIHtcbiAgICAgICAgICAgICAgICBpbnB1dFR5cGVzW2ldID0gdXRpbC5mb3JtYXQoJ2Zyb3plbjwlcz4nLCBpbnB1dFR5cGVzW2ldKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2Z1bmMgPSBvcHRpb25zLnVkYXNbdWRhS2V5XS5zZnVuYy50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgbGV0IHN0eXBlID0gb3B0aW9ucy51ZGFzW3VkYUtleV0uc3R5cGU7XG4gICAgICAgICAgICBzdHlwZSA9IHN0eXBlLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgIGlmIChzdHlwZS5pbmRleE9mKCc8JykgPiAtMSAmJiBzdHlwZS5pbmRleE9mKCdmcm96ZW48JykgIT09IDApIHtcbiAgICAgICAgICAgICAgc3R5cGUgPSB1dGlsLmZvcm1hdCgnZnJvemVuPCVzPicsIHN0eXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBmaW5hbGZ1bmMgPSBvcHRpb25zLnVkYXNbdWRhS2V5XS5maW5hbGZ1bmM7XG4gICAgICAgICAgICBpZiAoZmluYWxmdW5jKSBmaW5hbGZ1bmMgPSBmaW5hbGZ1bmMudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGVsc2UgZmluYWxmdW5jID0gbnVsbDtcbiAgICAgICAgICAgIGxldCBpbml0Y29uZCA9IG9wdGlvbnMudWRhc1t1ZGFLZXldLmluaXRjb25kO1xuICAgICAgICAgICAgaWYgKGluaXRjb25kKSBpbml0Y29uZCA9IGluaXRjb25kLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQucm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICBjb25zdCByZXN1bHRBcmd1bWVudFR5cGVzID0gcmVzdWx0LnJvd3NbaV0uYXJndW1lbnRfdHlwZXM7XG4gICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcmVzdWx0QXJndW1lbnRUeXBlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHJlc3VsdEFyZ3VtZW50VHlwZXNbal0gPSByZXN1bHRBcmd1bWVudFR5cGVzW2pdLnJlcGxhY2UoL1tcXHNdL2csICcnKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0QXJndW1lbnRUeXBlc1tqXS5pbmRleE9mKCc8JykgPiAtMSAmJiByZXN1bHRBcmd1bWVudFR5cGVzW2pdLmluZGV4T2YoJ2Zyb3plbjwnKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgcmVzdWx0QXJndW1lbnRUeXBlc1tqXSA9IHV0aWwuZm9ybWF0KCdmcm96ZW48JXM+JywgcmVzdWx0QXJndW1lbnRUeXBlc1tqXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgY29uc3QgcmVzdWx0U3RhdGVGdW5jID0gcmVzdWx0LnJvd3NbaV0uc3RhdGVfZnVuYztcbiAgICAgICAgICAgICAgbGV0IHJlc3VsdFN0YXRlVHlwZSA9IHJlc3VsdC5yb3dzW2ldLnN0YXRlX3R5cGU7XG4gICAgICAgICAgICAgIHJlc3VsdFN0YXRlVHlwZSA9IHJlc3VsdFN0YXRlVHlwZS5yZXBsYWNlKC9bXFxzXS9nLCAnJyk7XG4gICAgICAgICAgICAgIGlmIChyZXN1bHRTdGF0ZVR5cGUuaW5kZXhPZignPCcpID4gLTEgJiYgcmVzdWx0U3RhdGVUeXBlLmluZGV4T2YoJ2Zyb3plbjwnKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdFN0YXRlVHlwZSA9IHV0aWwuZm9ybWF0KCdmcm96ZW48JXM+JywgcmVzdWx0U3RhdGVUeXBlKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGNvbnN0IHJlc3VsdEZpbmFsRnVuYyA9IHJlc3VsdC5yb3dzW2ldLmZpbmFsX2Z1bmM7XG5cbiAgICAgICAgICAgICAgbGV0IHJlc3VsdEluaXRjb25kID0gcmVzdWx0LnJvd3NbaV0uaW5pdGNvbmQ7XG4gICAgICAgICAgICAgIGlmIChyZXN1bHRJbml0Y29uZCkgcmVzdWx0SW5pdGNvbmQgPSByZXN1bHRJbml0Y29uZC5yZXBsYWNlKC9bXFxzXS9nLCAnJyk7XG5cbiAgICAgICAgICAgICAgaWYgKHNmdW5jID09PSByZXN1bHRTdGF0ZUZ1bmMgJiZcbiAgICAgICAgICAgICAgICBzdHlwZSA9PT0gcmVzdWx0U3RhdGVUeXBlICYmXG4gICAgICAgICAgICAgICAgZmluYWxmdW5jID09PSByZXN1bHRGaW5hbEZ1bmMgJiZcbiAgICAgICAgICAgICAgICBpbml0Y29uZCA9PT0gcmVzdWx0SW5pdGNvbmQgJiZcbiAgICAgICAgICAgICAgICBfLmlzRXF1YWwoaW5wdXRUeXBlcywgcmVzdWx0QXJndW1lbnRUeXBlcykpIHtcbiAgICAgICAgICAgICAgICB1ZGFDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjcmVhdGVVREEoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3JlYXRlVURBKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sIChlcnIpID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgfSxcblxuICBfc2V0X2NsaWVudChjbGllbnQpIHtcbiAgICBjb25zdCBkZWZpbmVDb25uZWN0aW9uT3B0aW9ucyA9IF8uY2xvbmVEZWVwKHRoaXMuX2Nvbm5lY3Rpb24pO1xuXG4gICAgdGhpcy5fY2xpZW50ID0gY2xpZW50O1xuICAgIHRoaXMuX2RlZmluZV9jb25uZWN0aW9uID0gbmV3IGNxbC5DbGllbnQoZGVmaW5lQ29ubmVjdGlvbk9wdGlvbnMpO1xuXG4gICAgLy8gUmVzZXQgY29ubmVjdGlvbnMgb24gYWxsIG1vZGVsc1xuICAgIE9iamVjdC5rZXlzKHRoaXMuX21vZGVscykuZm9yRWFjaCgoaSkgPT4ge1xuICAgICAgdGhpcy5fbW9kZWxzW2ldLl9wcm9wZXJ0aWVzLmNxbCA9IHRoaXMuX2NsaWVudDtcbiAgICAgIHRoaXMuX21vZGVsc1tpXS5fcHJvcGVydGllcy5kZWZpbmVfY29ubmVjdGlvbiA9IHRoaXMuX2RlZmluZV9jb25uZWN0aW9uO1xuICAgIH0pO1xuICB9LFxuXG4gIGNvbm5lY3QoY2FsbGJhY2spIHtcbiAgICBjb25zdCBvblVzZXJEZWZpbmVkQWdncmVnYXRlcyA9IChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FsbGJhY2soZXJyLCB0aGlzKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25Vc2VyRGVmaW5lZEZ1bmN0aW9ucyA9IGZ1bmN0aW9uIGYoZXJyKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydF91c2VyX2RlZmluZWRfYWdncmVnYXRlcyhvblVzZXJEZWZpbmVkQWdncmVnYXRlcy5iaW5kKHRoaXMpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnZhbGlkYXRvci5pbnZhbGlkdWRhJywgZS5tZXNzYWdlKSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IG9uVXNlckRlZmluZWRUeXBlcyA9IGZ1bmN0aW9uIGYoZXJyKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydF91c2VyX2RlZmluZWRfZnVuY3Rpb25zKG9uVXNlckRlZmluZWRGdW5jdGlvbnMuYmluZCh0aGlzKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC52YWxpZGF0b3IuaW52YWxpZHVkZicsIGUubWVzc2FnZSkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBvbktleXNwYWNlID0gZnVuY3Rpb24gZihlcnIpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5fc2V0X2NsaWVudChuZXcgY3FsLkNsaWVudCh0aGlzLl9jb25uZWN0aW9uKSk7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9hc3NlcnRfdXNlcl9kZWZpbmVkX3R5cGVzKG9uVXNlckRlZmluZWRUeXBlcy5iaW5kKHRoaXMpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnZhbGlkYXRvci5pbnZhbGlkdWR0JywgZS5tZXNzYWdlKSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmICh0aGlzLl9rZXlzcGFjZSAmJiB0aGlzLl9vcHRpb25zLmNyZWF0ZUtleXNwYWNlKSB7XG4gICAgICB0aGlzLl9hc3NlcnRfa2V5c3BhY2Uob25LZXlzcGFjZS5iaW5kKHRoaXMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb25LZXlzcGFjZS5jYWxsKHRoaXMpO1xuICAgIH1cbiAgfSxcblxuICBhZGRfbW9kZWwobW9kZWxOYW1lLCBtb2RlbFNjaGVtYSwgY2FsbGJhY2spIHtcbiAgICBpZiAoIW1vZGVsTmFtZSB8fCB0eXBlb2YgKG1vZGVsTmFtZSkgIT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwudmFsaWRhdG9yLmludmFsaWRzY2hlbWEnLCAnTW9kZWwgbmFtZSBtdXN0IGJlIGEgdmFsaWQgc3RyaW5nJykpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBzY2hlbWVyLnZhbGlkYXRlX21vZGVsX3NjaGVtYShtb2RlbFNjaGVtYSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnZhbGlkYXRvci5pbnZhbGlkc2NoZW1hJywgZS5tZXNzYWdlKSk7XG4gICAgfVxuXG4gICAgY29uc3QgYmFzZVByb3BlcnRpZXMgPSB7XG4gICAgICBuYW1lOiBtb2RlbE5hbWUsXG4gICAgICBzY2hlbWE6IG1vZGVsU2NoZW1hLFxuICAgICAga2V5c3BhY2U6IHRoaXMuX2tleXNwYWNlLFxuICAgICAgZGVmaW5lX2Nvbm5lY3Rpb246IHRoaXMuX2RlZmluZV9jb25uZWN0aW9uLFxuICAgICAgY3FsOiB0aGlzLl9jbGllbnQsXG4gICAgICBnZXRfY29uc3RydWN0b3I6IHRoaXMuZ2V0X21vZGVsLmJpbmQodGhpcywgbW9kZWxOYW1lKSxcbiAgICAgIGNvbm5lY3Q6IHRoaXMuY29ubmVjdC5iaW5kKHRoaXMpLFxuICAgICAgZHJvcFRhYmxlT25TY2hlbWFDaGFuZ2U6IHRoaXMuX29wdGlvbnMuZHJvcFRhYmxlT25TY2hlbWFDaGFuZ2UsXG4gICAgICBtaWdyYXRpb246IHRoaXMuX29wdGlvbnMubWlncmF0aW9uLFxuICAgICAgZGlzYWJsZVRUWUNvbmZpcm1hdGlvbjogdGhpcy5fb3B0aW9ucy5kaXNhYmxlVFRZQ29uZmlybWF0aW9uLFxuICAgIH07XG5cbiAgICByZXR1cm4gKHRoaXMuX21vZGVsc1ttb2RlbE5hbWVdID0gdGhpcy5fZ2VuZXJhdGVfbW9kZWwoYmFzZVByb3BlcnRpZXMsIGNhbGxiYWNrKSk7XG4gIH0sXG5cbiAgZ2V0X21vZGVsKG1vZGVsTmFtZSkge1xuICAgIHJldHVybiB0aGlzLl9tb2RlbHNbbW9kZWxOYW1lXSB8fCBudWxsO1xuICB9LFxuXG4gIGNsb3NlKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBub29wO1xuXG4gICAgaWYgKCF0aGlzLl9jbGllbnQpIHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX2NsaWVudC5zaHV0ZG93bigoZXJyKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuX2RlZmluZV9jb25uZWN0aW9uKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2RlZmluZV9jb25uZWN0aW9uLnNodXRkb3duKChkZXJyKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKGVyciB8fCBkZXJyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBcG9sbG87XG4iXX0=